{"version":3,"sources":["app/unpublished.js","node_modules/auto-reload-brunch/vendor/auto-reload.js"],"names":["require","register","exports","module","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","_typeof","Symbol","iterator","obj","constructor","prototype","cacheBlockTitle","username","fetchUnpublishedCaches","$","button","ajax","url","success","data","prop","hide","alert","message","show","html","counter","each","unpublishedCaches","gccode","title","append","count","error","jqXHR","textStatus","errorThrown","console","fetchUnpublishedCachesFromGM","guid","click","btn","this","text","val","type","password","remove","prepend","signout","location","reload","is","on","e","countFrom","parseInt","parents","countTo","slideUp","change","_$","list","create","push","value","removeClass","getGeocache","cacheNumber","encodeURIComponent","beforeSend","done","addClass","toFixed","fail","status","always","popover","trigger","animation","listOfPromises","map","when","apply","then","gpx","arguments","jsonData","split","link","err","log","greasemonkey","cookieRegistry","readCookie","name","nameEQ","ca","document","cookie","c","charAt","substring","indexOf","listenCookieChange","cookieName","callback","setInterval","ready","logged","WebSocket","window","MozWebSocket","br","brunch","ar","disabled","_ar","cacheBuster","date","Math","round","Date","now","toString","replace","browser","navigator","userAgent","toLowerCase","forceRepaint","reloaders","page","stylesheet","slice","call","querySelectorAll","filter","getAttribute","href","forEach","setTimeout","body","offsetHeight","javascript","scripts","textScripts","script","srcScripts","src","loaded","all","onLoad","eval","newScript","createElement","async","onload","head","appendChild","port","host","server","hostname","connect","connection","onmessage","event","reloader","onerror","readyState","close","onclose"],"mappings":"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","file":"web/js/app.min.js.map","sourcesContent":["/* jshint esversion: 6 */\n/* global $:true */\n\n(function() {\n    'use strict';\n\n    const cacheBlockTitle = 'From your account';\n\n    let username = null;\n\n    var fetchUnpublishedCaches = function() {\n            $('#refresh-cache').button('loading');\n            $('#create-gpx').button('reset');\n            $.ajax({\n                url: 'unpublished.php',\n                success: function(data) {\n                    $('#select-all').prop('checked', false);\n                    $('#fetching-unpublished-caches').hide();\n                    $('#refresh-cache').button('reset');\n                    if (!data || data === '' || typeof data !== 'object') {\n                        return false;\n                    }\n                    if (data && !data.success) {\n                        alert(data.message);\n                    } else {\n                        $('#table-unpublished-caches').show();\n                        $('#table-caches tbody').html('');\n\n                        var counter = 0;\n                        $.each(data.unpublishedCaches, function(gccode, title) {\n                            ++counter;\n                            $('#table-caches tbody')\n                                .append('<tr class=\"' + gccode + '\" data-counter=\"' + counter + '\">\\n' +\n                                    '   <td>#' + counter + '</td>\\n' +\n                                    '   <td><input type=\"checkbox\" name=\"cache\" class=\"unpublished-geocache\" value=\"' + gccode + '\" id=\"' + gccode + '\" /></td>\\n' +\n                                    '   <td><label for=\"' + gccode + '\">' + title + '</label></td>\\n' +\n                                    '   <td class=\"link\"><a href=\"https://coord.info/' + gccode + '\" title=\"View on geocaching.com\"><span class=\"glyphicon glyphicon-new-window\"></span></a></td>\\n' +\n                                    '   <td class=\"status\"> </td>\\n' +\n                                    '</tr>\\n');\n                        });\n                        $('#unpublishedCachesBlock h4').html(cacheBlockTitle + ' (' + data.count + ')');\n\n                        $('#table-caches tbody').show();\n                    }\n                },\n                error: function(jqXHR, textStatus, errorThrown) {\n                    console.error(jqXHR, textStatus, errorThrown);\n                }\n            });\n        },\n\n        fetchUnpublishedCachesFromGM = function() {\n            //$('#unpublishedCachesBlock-gm').show();\n            $.ajax({\n                url: 'unpublished-gm.php',\n                success: function(data) {\n                    if (!data || data === '' || typeof data !== 'object') {\n                        return false;\n                    }\n                    if (data && !data.success) {\n                        alert(data.message);\n                        return false;\n                    }\n                    if (data.unpublishedCaches) {\n                        $('#table-unpublished-caches-gm').show();\n                        $('#table-caches-gm tbody').html('');\n\n                        $.each(data.unpublishedCaches, function(guid, title) {\n                            $('#table-caches-gm tbody')\n                                .append('<tr>\\n' +\n                                    '   <td><input type=\"checkbox\" name=\"cache-gm\" class=\"unpublished-geocache-gm\" value=\"' + guid + '\" id=\"' + guid + '-gm\" /></td>\\n' +\n                                    '   <td><label for=\"' + guid + '-gm\">' + title + '</label></td>\\n' +\n                                    '   <td class=\"link\"><a href=\"https://www.geocaching.com/seek/cache_details.aspx?guid=' + guid + '\" title=\"View on geocaching.com\"><span class=\"glyphicon glyphicon-new-window\"></span></a></td>\\n' +\n                                    '</tr>\\n');\n                        });\n                    }\n                },\n                error: function(jqXHR, textStatus, errorThrown) {\n                    console.error(jqXHR, textStatus, errorThrown);\n                }\n            });\n        };\n\n    $('#login').click(function() {\n        var btn = $(this);\n        if ($(this).text() === 'Sign in') {\n\n            if ($('#username').val() === '' || $('#password').val() === '') {\n                btn.button('reset');\n                return false;\n            }\n\n            $('#username').prop('disabled', true);\n            $('#password').prop('disabled', true);\n\n            btn.button('loading');\n\n            $.ajax({\n                url: 'login.php',\n                type: 'POST',\n                data: {\n                    username: $('#username').val(),\n                    password: $('#password').val()\n                },\n                success: function(data) {\n                    if (!data || data === '' || typeof data !== 'object') {\n                        return false;\n                    }\n                    if (data && !data.success) {\n                        btn.button('reset');\n                        $('#username').prop('disabled', false);\n                        $('#password').prop('disabled', false);\n                        alert(data.message);\n                        return false;\n                    }\n                    username = data.username;\n                    $('#username').remove();\n                    $('#password').remove();\n                    $('#gc-form-login').prepend('<span id=\"signin\">Hello ' + data.username + '!</span>');\n                    btn.button('signout');\n\n                    $('#unpublishedCachesBlock').show();\n                    $('#fetching-unpublished-caches').show();\n                    fetchUnpublishedCaches();\n                },\n                error: function(jqXHR, textStatus, errorThrown) {\n                    console.error(jqXHR, textStatus, errorThrown);\n                }\n            });\n        } else if ($(this).text() === 'Sign out') {\n\n            $('#unpublishedCachesBlock').hide();\n            btn.button('loading');\n\n            $.ajax({\n                url: 'login.php',\n                type: 'POST',\n                data: {\n                    signout: true\n                },\n                success: function(data) {\n                    if (!data || data === '' || typeof data !== 'object') {\n                        return false;\n                    }\n                    if (data && data.success) {\n                        location.reload();\n                    }\n                },\n                error: function(jqXHR, textStatus, errorThrown) {\n                    console.error(jqXHR, textStatus, errorThrown);\n                }\n            });\n        }\n    });\n\n    $('#select-all').click(function() {\n        $('.unpublished-geocache').prop('checked', $(this).is(':checked'));\n    });\n\n    $('#select-all-gm').click(function() {\n        $('.unpublished-geocache-gm').prop('checked', $(this).is(':checked'));\n    });\n\n    $('#table-caches tbody').on('click', 'input[type=checkbox]', function(e) {\n        if ($('#chk_select').prop('checked') && $(this).prop('checked')) {\n            var countFrom = parseInt($(this).parents('tr').data(\"counter\"), 10),\n                countTo = parseInt($('#block_select input[type=range]').val(), 10) - 1;\n            $('#table-caches tbody tr:nth-child(n+' + (countFrom + 1) + '):nth-child(-n+' + (countFrom + countTo) + ') input[type=checkbox]').prop('checked', true);\n        }\n    });\n    $('#refresh-cache').click(function() {\n        $('#table-caches tbody').slideUp(400, fetchUnpublishedCaches);\n    });\n\n    $('#refresh-cache-gm').click(function() {\n        $(this).button('loading');\n        fetchUnpublishedCachesFromGM();\n        $('#select-all-gm').prop('checked', false);\n        $(this).button('reset');\n    });\n\n    $('#chk_split').change(function(e) {\n        if (!$(this).prop('checked')) {\n            $('#block_split input[type=range]').prop('disabled', true);\n        } else {\n            $('#block_split input[type=range]').prop('disabled', false);\n        }\n    });\n\n    $('#block_split input[type=range]').change(function(e) {\n        $('label[for=chk_split]').html('Split GPX files by ' + $(this).val() + ' geocaches');\n    });\n\n    $('#chk_select').change(function(e) {\n        if (!$(this).prop('checked')) {\n            $('#block_select input[type=range]').prop('disabled', true);\n        } else {\n            $('#block_select input[type=range]').prop('disabled', false);\n        }\n    });\n\n    $('#block_select input[type=range]').change(function(e) {\n        $('label[for=chk_select]').html('Pick ' + $(this).val() + ' geocaches');\n    });\n\n    $('#create-gpx').click(function() {\n        var list = [],\n            create = $(this);\n\n        $('input[name=cache]:checked').each(function() {\n            list.push(this.value);\n        });\n\n        if (list.length <= 0) {\n            alert('You must choose at least one cache.');\n            return false;\n        }\n\n        $('#download-links').html('');\n        $('#table-caches tbody tr').removeClass('success');\n        $('#table-caches tbody tr').removeClass('danger');\n        $('#table-caches .status').html('');\n        create.button('loading');\n\n        let count = 0,\n            getGeocache = function(gccode) {\n                var cacheNumber = $('tr.' + gccode).data('counter');\n\n                return $.ajax({\n                    url: 'geocaches.php?n=' + encodeURIComponent(cacheNumber),\n                    type: 'POST',\n                    data: {\n                        'gccode': gccode,\n                        'username': username\n                    },\n                    beforeSend: function() {\n                        $('.' + gccode + ' .status').html('<img src=\"loader.gif\" alt=\"\">');\n                    }\n                }).done(function(data) {\n                    if (data && data.success) {\n                        $('.' + data.gccode).addClass('success');\n                        $('.' + data.gccode + ' .status').html('<span class=\"glyphicon glyphicon-ok\"></span>');\n                    } else {\n                        $('.' + data.gccode).addClass('danger');\n                        $('.' + data.gccode + ' .status').html('<span class=\"glyphicon glyphicon-remove\" data-html=\"true\" data-content=\"' + data.message + '\"></span>');\n                    }\n                    $('#create-gpx').html('Creating... ' + (++count / list.length * 100).toFixed(1) + '%');\n                }).fail(function(jqXHR, textStatus, errorThrown) {\n                    $('.' + gccode).addClass('danger');\n                    $('.' + gccode + ' .status').html('<span class=\"glyphicon glyphicon-remove\" data-html=\"true\" data-content=\"<strong>Error ' + jqXHR.status + '</strong>: ' + errorThrown + '\"></span>');\n                }).always(function(jqXHR, textStatus) {\n                    $('.' + gccode + ' .status span').popover({\n                        trigger: 'hover',\n                        animation: false\n                    });\n                });\n            };\n\n        //from http://blog.xebia.fr/2012/11/28/les-objets-differes-et-les-promesses-en-jquery/\n        //On transforme la liste d'identifiants en liste de promesses de noms correspondant à ces id\n        let listOfPromises = list.map(getGeocache);\n\n        $.when(...listOfPromises).then(function() {\n            let gpx = [];\n\n            if (listOfPromises.length > 1) {\n                for (var i = 0, length = listOfPromises.length; i < length; ++i) {\n                    //Arguments est une variable magique contenant les paramètres de la fonction\n                    //Les paramètres sont passés dans le même ordre que les promesses.\n                    if (arguments[i][0].success) {\n                        gpx.push(arguments[i][0].gccode);\n                    }\n                }\n            } else if (arguments[0].success) {\n                gpx.push(arguments[0].gccode);\n            }\n\n            if (gpx.length > 0) {\n                var jsonData = {\n                    'gccode': gpx\n                };\n                if ($('#chk_split').prop('checked')) {\n                    jsonData.split = $('#block_split input[type=range]').val();\n                }\n                $.ajax({\n                    url: 'download.php',\n                    type: 'POST',\n                    data: jsonData,\n                    success: function(data) {\n                        if (data && data.success) {\n                            $('#download-links').append(data.link);\n                        }\n                    },\n                    error: function(jqXHR, textStatus, errorThrown) {\n                        console.error(jqXHR, textStatus, errorThrown);\n                    }\n                });\n            }\n            create.button('reset');\n        }, function(err) {\n            create.button('reset');\n            console.log(\"rejection callback\");\n        });\n    });\n\n    $('#create-gpx-gm').click(function() {\n        var list = [];\n\n        $('input[name=cache-gm]:checked').each(function() {\n            list.push(this.value);\n        });\n\n        if (list.length <= 0) {\n            alert('You must choose at least one cache.');\n            return false;\n        }\n\n        $('#download-links-gm').html('');\n        $(this).button('loading');\n\n        if (list.length > 0) {\n            $.ajax({\n                url: 'download.php',\n                type: 'POST',\n                data: {\n                    'gccode': list,\n                    'greasemonkey': true\n                },\n                success: function(data) {\n                    if (data && data.success) {\n                        $('#download-links-gm').append(data.link);\n                    }\n                },\n                error: function(jqXHR, textStatus, errorThrown) {\n                    console.error(jqXHR, textStatus, errorThrown);\n                }\n            });\n        }\n        $(this).button('reset');\n    });\n\n    var cookieRegistry = [],\n        readCookie = function(name) {\n            var nameEQ = name + '=';\n            var ca = document.cookie.split(';');\n            for (var i = 0, length = ca.length; i < length; ++i) {\n                var c = ca[i];\n                while (c.charAt(0) === ' ') c = c.substring(1, c.length);\n                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);\n            }\n            return null;\n        },\n\n        listenCookieChange = function(cookieName, callback) {\n            setInterval(function() {\n                if (cookieRegistry[cookieName]) {\n                    if (readCookie(cookieName) !== cookieRegistry[cookieName]) {\n                        // update registry so we dont get triggered again\n                        cookieRegistry[cookieName] = readCookie(cookieName);\n                        return callback();\n                    }\n                } else {\n                    cookieRegistry[cookieName] = readCookie(cookieName);\n                }\n            }, 1000);\n        };\n\n    // bind the listener\n    listenCookieChange('unpublished', function() {\n        $('#refresh-cache-gm').trigger('click');\n    });\n\n    $().ready(function() {\n        fetchUnpublishedCachesFromGM();\n        if (logged === 'true') {\n            $('#fetching-unpublished-caches').show(0, fetchUnpublishedCaches);\n        }\n    });\n}());\n","/* jshint ignore:start */\n(function() {\n  var WebSocket = window.WebSocket || window.MozWebSocket;\n  var br = window.brunch = (window.brunch || {});\n  var ar = br['auto-reload'] = (br['auto-reload'] || {});\n  if (!WebSocket || ar.disabled) return;\n  if (window._ar) return;\n  window._ar = true;\n\n  var cacheBuster = function(url){\n    var date = Math.round(Date.now() / 1000).toString();\n    url = url.replace(/(\\&|\\\\?)cacheBuster=\\d*/, '');\n    return url + (url.indexOf('?') >= 0 ? '&' : '?') +'cacheBuster=' + date;\n  };\n\n  var browser = navigator.userAgent.toLowerCase();\n  var forceRepaint = ar.forceRepaint || browser.indexOf('chrome') > -1;\n\n  var reloaders = {\n    page: function(){\n      window.location.reload(true);\n    },\n\n    stylesheet: function(){\n      [].slice\n        .call(document.querySelectorAll('link[rel=stylesheet]'))\n        .filter(function(link) {\n          var val = link.getAttribute('data-autoreload');\n          return link.href && val != 'false';\n        })\n        .forEach(function(link) {\n          link.href = cacheBuster(link.href);\n        });\n\n      // Hack to force page repaint after 25ms.\n      if (forceRepaint) setTimeout(function() { document.body.offsetHeight; }, 25);\n    },\n\n    javascript: function(){\n      var scripts = [].slice.call(document.querySelectorAll('script'));\n      var textScripts = scripts.map(function(script) { return script.text }).filter(function(text) { return text.length > 0 });\n      var srcScripts = scripts.filter(function(script) { return script.src });\n\n      var loaded = 0;\n      var all = srcScripts.length;\n      var onLoad = function() {\n        loaded = loaded + 1;\n        if (loaded === all) {\n          textScripts.forEach(function(script) { eval(script); });\n        }\n      }\n\n      srcScripts\n        .forEach(function(script) {\n          var src = script.src;\n          script.remove();\n          var newScript = document.createElement('script');\n          newScript.src = cacheBuster(src);\n          newScript.async = true;\n          newScript.onload = onLoad;\n          document.head.appendChild(newScript);\n        });\n    }\n  };\n  var port = ar.port || 9485;\n  var host = br.server || window.location.hostname || 'localhost';\n\n  var connect = function(){\n    var connection = new WebSocket('ws://' + host + ':' + port);\n    connection.onmessage = function(event){\n      if (ar.disabled) return;\n      var message = event.data;\n      var reloader = reloaders[message] || reloaders.page;\n      reloader();\n    };\n    connection.onerror = function(){\n      if (connection.readyState) connection.close();\n    };\n    connection.onclose = function(){\n      window.setTimeout(connect, 1000);\n    };\n  };\n  connect();\n})();\n/* jshint ignore:end */\n"]}